

# FUSE Integrity Filesystem
一个基于FUSE的文件完整性校验文件系统，为现有文件系统（如ext4）提供透明化的文件完整性保护。

<br />

与现有完整性校验方案对比
| 完整性校验方式 | fsverity | ima+selinux | fsIntegrity (自研FUSE模块) |
|---------|----------|-------------|----------------------------|
| **保护粒度** | 支持文件粒度 | 支持文件粒度 | 支持文件粒度 |
| **校验级别** | 页面按需校验 | 全文件计算哈希校验 | 全文件计算哈希校验 |
| **性能特点** | 对大文件读取部分数据性能非常好 | 全文计算哈希校验，性能一般 | 全文计算哈希校验，性能一般 |
| **保护后是否可写** | 支持"带条件写入"，通过"备份+拷贝+重新启用verity"实现逻辑上可写，源文件inode和新文件inode不是同一个 | 支持"带条件写入"，写入后需要重新签名，如果不重新签名，那么读取也会失败 | 配置后，读写过程中支持无感校验 |
| **校验时机** | 读文件中每一个页面时 | 按策略触发，可按文件访问时 | 可自定义，当前实现posix语义的read、mmap等 |

fsIntegrity相比于fsverity与ima+selinux来说优点是可以实现无感校验，写入后自动更新hash值。
 
## 目录

  - [开发前的配置要求](#开发前的配置要求)
  - [安装步骤](#安装步骤)
- [文件目录说明](#文件目录说明)
- [开发的架构](#开发的架构)
- [部署](#部署)
- [使用到的框架](#使用到的框架)
- [详细说明](#详细说明)
- [性能对比数据参考](#性能对比数据参考)
- [贡献者](#贡献者)
  - [如何参与开源项目](#如何参与开源项目)
- [版本控制](#版本控制)
- [作者](#作者)
- [鸣谢](#鸣谢)



### 开发前的配置要求

待补充

### **安装步骤**

待补充

### 文件目录说明
eg:

```
fsIntegrity/
├── integrity_fuse_fs.c   # 主程序源代码
├── README.md             # 项目说明文档
├── examples/             # 示例和测试脚本
│   ├── test_integrity.sh # 完整性测试脚本
│   └── benchmark.sh      # 性能测试脚本
└── LICENSE               # 许可证文件

```

## 详细说明
### fsverity
- **优点**：性能最佳，特别适合大文件的部分读取场景
- **缺点**：写入操作复杂，需要复制文件并重新启用校验
- **适用场景**：只读或很少修改的大文件，如系统镜像、容器镜像等

### ima+selinux
- **优点**：与Linux安全模块深度集成，支持灵活的策略配置
- **缺点**：需要内核支持和复杂的策略配置，写入后需要重新签名
- **适用场景**：需要与SELinux策略集成的企业安全环境
  
### fsIntegrity (自研FUSE模块)
- **优点**：
  - 用户空间实现，无需内核修改
  - 配置简单，部署灵活
  - 支持透明的读写校验
  - 跨平台兼容性好
- **缺点**：
  - FUSE层性能开销
  - 大文件全量哈希计算开销
- **适用场景**：
  - 需要快速部署的完整性保护
  - 非Linux平台或旧内核系统
  - 中小文件为主的场景
  - 开发和测试环境

## 性能对比数据参考

| 文件大小 | fsverity | ima+selinux | fsIntegrity |
|----------|----------|-------------|-------------|
| 1KB | 0.1ms | 0.2ms | 0.2ms |
| 1MB | 0.5ms | 5ms | 5ms |
| 100MB | 5ms | 500ms | 500ms |
| 1GB (读取10MB) | 10ms | 5s | 5s |

*注：以上为理论参考值，实际性能受硬件、系统负载等因素影响*

### 开发的架构 

基于fuse开发，fuse官方项目：https://github.com/libfuse/libfuse。

### 部署

```
# 在前台运行并查看日志
./integrityfs /data /mnt/integrity -f 2>&1 | tee fs.log
```


### 贡献者
待补充

#### 如何参与开源项目

贡献使开源社区成为一个学习、激励和创造的绝佳场所。你所作的任何贡献都是**非常感谢**的。

### 版本控制

该项目使用Git进行版本管理。您可以在repository参看当前可用版本。

### 作者
待补充

### 版权说明

该项目签署了MIT 授权许可，详情请参阅 [LICENSE.txt](https://github.com/liuqingman/fsIntegrity/blob/main/LICENSE.txt)

### 鸣谢
